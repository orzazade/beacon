---
phase: 11-teams-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [Auth/MicrosoftAuth.swift, Services/Teams/TeamsModels.swift, Services/Teams/TeamsService.swift]
autonomous: true
---

<objective>
Create Teams API infrastructure with OAuth scope, models, and service actor.

Purpose: Establish the foundation for fetching Microsoft Teams chat messages via Graph API.
Output: TeamsService actor ready to fetch chats and messages, with all required models.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Reference existing patterns:
@Beacon/Auth/MicrosoftAuth.swift
@Beacon/Services/Outlook/OutlookService.swift
@Beacon/Services/Outlook/OutlookModels.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Chat.Read OAuth scope</name>
  <files>Auth/MicrosoftAuth.swift</files>
  <action>
Add `Chat.Read` to the graphScopes array to enable Teams chat access:

```swift
private let graphScopes = ["User.Read", "Mail.Read", "Mail.ReadWrite", "Chat.Read"]
```

This scope is required for accessing `/me/chats` and `/chats/{id}/messages` Graph API endpoints.
  </action>
  <verify>swift build succeeds without errors</verify>
  <done>Chat.Read scope added to graphScopes array</done>
</task>

<task type="auto">
  <name>Task 2: Create Teams API models</name>
  <files>Services/Teams/TeamsModels.swift</files>
  <action>
Create new file `Services/Teams/TeamsModels.swift` with Codable models for Graph API responses:

1. `TeamsChatsResponse` - wrapper with `value: [TeamsChat]` and optional `@odata.nextLink`
2. `TeamsChat` - id, topic (optional), chatType, lastUpdatedDateTime, webUrl, lastMessagePreview (optional)
3. `TeamsChatMessagesResponse` - wrapper with `value: [TeamsChatMessage]`
4. `TeamsChatMessage` - id, messageType, createdDateTime, body, from, importance (optional)
5. `TeamsMessageBody` - contentType, content
6. `TeamsMessageFrom` - user (optional with id, displayName)
7. `TeamsUser` - id, displayName

Follow the pattern from OutlookModels.swift. All properties should match Graph API JSON exactly.
  </action>
  <verify>swift build succeeds, all models compile</verify>
  <done>All 7 Teams models created and compiling</done>
</task>

<task type="auto">
  <name>Task 3: Create TeamsService actor</name>
  <files>Services/Teams/TeamsService.swift</files>
  <action>
Create new file `Services/Teams/TeamsService.swift` as an actor (thread-safe like OutlookService):

```swift
actor TeamsService {
    private let auth: MicrosoftAuth

    init(auth: MicrosoftAuth) { self.auth = auth }

    /// Fetch recent chats with last message preview
    func getRecentChats() async throws -> [TeamsChat]

    /// Fetch recent messages from all chats (for unified task list)
    func getRecentMessages() async throws -> [TeamsChatMessage]
}
```

Implementation details:
- `getRecentChats()`: GET /me/chats?$expand=lastMessagePreview&$orderby=lastUpdatedDateTime desc&$top=20
- `getRecentMessages()`: For each chat from getRecentChats(), fetch messages from last 24 hours, return only messages where importance == "urgent" OR from last hour
- Use auth.acquireGraphToken() for authorization
- Create TeamsError enum matching OutlookError pattern (fetchFailed, invalidResponse, httpError)
  </action>
  <verify>swift build succeeds, actor compiles with all methods</verify>
  <done>TeamsService actor created with getRecentChats and getRecentMessages methods</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] swift build succeeds without errors
- [ ] Chat.Read added to MicrosoftAuth.graphScopes
- [ ] Services/Teams/TeamsModels.swift exists with all models
- [ ] Services/Teams/TeamsService.swift exists as actor
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No new compiler warnings
- TeamsService ready for integration in Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/11-teams-integration/11-01-SUMMARY.md`
</output>
